# Import required libraries
from itertools import zip_longest
import streamlit as st
from langchain_community.document_loaders import PyPDFLoader
from streamlit_chat import message
from langchain_openai import OpenAIEmbeddings
from langchain_community.vectorstores import FAISS
from langchain.schema import (
    SystemMessage,
    HumanMessage,
    AIMessage
)
import os
from langchain_community.document_loaders import PyPDFLoader
from langchain_community.vectorstores import FAISS
from langchain_text_splitters import RecursiveCharacterTextSplitter
from langchain_openai import OpenAIEmbeddings
from langchain.chains import create_history_aware_retriever
from langchain_core.prompts import MessagesPlaceholder
from langchain_core.prompts import ChatPromptTemplate
from langchain_openai import ChatOpenAI
from langchain_core.messages import HumanMessage, AIMessage
from langchain.chains.combine_documents import create_stuff_documents_chain
from langchain.chains import create_retrieval_chain
from langchain_community.document_loaders import WebBaseLoader
from langchain_core.documents import Document

#Load environment variables
# Set streamlit page configuration
st.set_page_config(page_title="AI-Kurs ChatBot")
st.title("AI-Kurs ChatBot")

# Initialize session state variables
if 'generated' not in st.session_state:
    st.session_state['generated'] = []  # Store AI generated responses

if 'past' not in st.session_state:
    st.session_state['past'] = []  # Store past user inputs

if 'entered_prompt' not in st.session_state:
    st.session_state['entered_prompt'] = ""  # Store the latest user input

# Initialize the ChatOpenAI model
chat = ChatOpenAI(
    temperature=0.5,
    model_name="gpt-4-turbo",
    api_key=st.secrets['openai_api_key']
)
# Intialize embeddings
embeddings = OpenAIEmbeddings(openai_api_key=st.secrets['openai_api_key'])

#Fetch and load documents
#path = "app/static/CV.pdf"
#loader = PyPDFLoader(path)
#docs = loader.load()

#Indexing
text_splitter = RecursiveCharacterTextSplitter()
#documents = text_splitter.split_documents(docs)
documents = [Document(page_content=\'Harald Andreas Osan\\nSenior Associate\\nKPMG\\n47679043harald.osan@kpmg.no\\nSPISSKOMPETANSE\\nDataanalyse\\nMaskinl\xe6ring & AI\\nDatah\xe5ndtering\\nMicrosoft Azure\\nPower BI\\nSkyarkitektur\\nPython\\nAzure DevOps\\nDynamics 365ERFARING\\nHarald er skyspesialist i tjenesteomr\xe5det Cloud Enablement i KPMG. Han har \\nerfaring innen utvikling, implementering og forvaltning av skytjenester med \\nspesialkompetanse innen Azure. Harald jobber med en rekke Azure-applikasjoner, \\nmed arbeidsoppgaver hovedsakelig relatert til forretningsanalyse, skyarkitektur og \\ndatavitenskap. Harald har ogs\xe5 bred erfaring med implementering og forvaltning av \\nMicrosoft Dynamics 365, b\xe5de funksjonelt og teknisk. Hans kompetanse i \\nskj\xe6ringspunktet mellom teknologi og \xf8konomi med utdanning og erfaring fra begge \\nomr\xe5der.  Harald har prosjekterfaring innenfor integrasjonsutvikling, forvaltning, \\ndatah\xe5ndtering og analyse for blant annet SalMar, Spar Kj\xf8p, Aschehoug, HTS og \\nFerde. \\nHarald er utdannet ved Universitetet i Agder og Universitetet i Bergen. Han har en \\nbachelor i \xd8konomi og Administrasjon og bachelor i Informasjonsvitenskap. Dette \\nhar gitt Harald god tverrfaglig kompetanse i skj\xe6ringspunktet mellom teknologi og \\n\xf8konomi.  \\nTIDLIGERE ARBEIDSERFARING\\nKPMG\\nSenior Associate , 10.2023 - d.d.\\nKPMG\\nAssociate , 08.2021 - 09.2023\\nUniversitetet i Bergen\\nProgramvareutvikler , 06.2020 - 08.2020\\nSommerjobb som utvikler for st\xf8rre forskningsprosjekt ved Universitetet i Bergen. \\nProsjektet innebar utvikling av webapplikasjon som ble benyttet for \xe5 m\xe5le studenters\\nprogresjon innenfor programmering. Fullstack-utvikler med teknologier som JS, \\nPython, Docker, MongoDB og Svelte. \\nUniversitetet i Bergen\\nVitenskapelig assistent , 08.2020 - 06.2021\\nSeminarleder i emnet "Innf\xf8ring i Programmering" ved Samfunnsvitenskapelig \\nfakultet. Innebar undervisning for studenter og sensur av obligatoriske arbeidskrav. \\nUTDANNING\\nBachelor i \xf8konomi og administrasjon, Universitetet i Agder (UiA) , 2016 - 2019\\nBacheloroppgave: Prissetting p\xe5 kraftkontrakter i det kortsiktige terminmarkedet \\n(2019)\\nBachelor i Informasjonsvitenskap, Universitetet i Bergen (UiB) , 2019 - 2021\\nANNEN RELEVANT INFORMASJON\\n  Linjeforening Infomedia ved UiB (2019 - 2021)\\nArbeidet med bedriftsutvalget som innebar planlegging og gjennomf\xf8ring av \\nbedriftsarrangementer for studenter ved SV-fakultetet ved universitetet i Bergen. \\n  Mercurius Linjeforening for \xf8konomistudenter ved UiA (2017 - 2019)\\nJobbet med planlegging og gjennomf\xf8ring av sosiale begivenheter for studenter ved \\nHandelsh\xf8yskolen ved Universitetet i Agder. \\nSPR\xc5K\\n  Engelsk: Flytende\\n  Norsk: Morsm\xe5l\\nPROSJEKTERFARING\\nH. Aschehoug  & Co (W. Implementering av Microsoft Dynamics 365FO, 02.2023 - d.d.\\n\xa9 2024  KPMG AS, a Norwegian limited liability company and a member firm of the KPMG network of independent member firms affiliated with KPMG International Cooperative (KPMG International), a Swiss entity. All rights reserved.\', metadata={\'source\': \'merged.pdf\', \'page\': 0}), Document(page_content=\'Harald Andreas Osan\\nSenior Associate\\nNygaard)\\nSektor:Privat sektorDatamigreringslead, ca. 600 timer\\nH. Aschehoug & Co., kjent som Aschehoug, er et av de st\xf8rste uavhengige \\nforlagsselskapene i Norge, grunnlagt i 1872. Forlaget har hovedkontor i Oslo og har \\n480 ansatte. Aschehoug-gruppen omfatter ogs\xe5 andre forlag som helt eller delvis eies\\nav Aschehoug. Aschehoug bruker for \xf8yeblikket AX 2012 og \xf8nsket derfor \xe5 bytte til \\nDynamics 365 Finance & Operations. KPMG er ansvarlig for implementeringen av \\nDynamics 365. Vi bruker rammeverket som fokuserer p\xe5 prosesser for l\xf8sning, kalt \\nPowered Enterprise. \\nDatamigreringslead: Som ansvarlig for datamigrering har Harald gjennomf\xf8rt \\nkartlegging av n\xf8dvendige dataomr\xe5der, satt opp rammeverk for gjennomf\xf8ring av \\ndatamigrering, gjennomf\xf8rt datatransformasjon, datavask i henhold til \\nforretningsmessige behov, innlasting og feilh\xe5ndtering. Utviklet l\xf8sningsarkitektur for \\ntilgjengeliggj\xf8ring av data for analyse i Power BI via datavarehusl\xf8sning.\\nSalMar ASA\\nSektor:Privat sektorOppgradering av ERP-l\xf8sning til Dynamics 365, 09.2021 - d.d.\\nFinanskonsulent, ca. 1300 timer\\nSalMar implementerte ny ERP l\xf8sning basert p\xe5 Microsoft D365 Finance ERP for 13 \\nselskap i konsernet. KPMG bist\xe5r som implementeringspartner og har ansvaret for \xe5 \\nkonfigurere, lage tilpasninger og integrasjoner mot andre systemer som Maritech \\nTrading. KPMG bist\xe5r ogs\xe5 med \xe5 avdekke nye krav hos kunden og foresl\xe5 \\nforbedringer som en helintegrert bankl\xf8sning. L\xf8sningen som blir implementert vil \\ninneholde kundereskontro, leverand\xf8rreskontro, innkj\xf8p, prosjekt, salg, inng\xe5ende \\nfakturasystem, datavarehus og Power BI til rapportering. \\nFinanskonsulent: Harald arbeidet som ressurs i finansteamet med konfigurering av \\nl\xf8sning, utvikling og dokumentering av integrasjoner, testing og utrulling av l\xf8sning. \\nHan har ogs\xe5 bist\xe5tt med superbrukeroppl\xe6ring og prosjektstyring i Azure DevOps.  \\nHar videre v\xe6rt hovedressurs for selskapet etter l\xf8sning har blitt tatt i bruk og \\nimplementert flere tilpasninger innenfor finansmodulene i Dynamics 365, herunder \\nl\xf8sning for konsolidering, forsikring, anleggsmidler og avstemming, med utviklerteam \\ngjennom KPMG Managed Services. \\nKnowit-konsernet\\nSektor:Privat sektorRevisjon - Cash to Revenue-analyse, 01.2023 - 02.2023\\nPower BI-konsulent, ca. 50 timer\\nUtviklet Power BI modell benyttet i konsernrevisjon. Modell inneholdt konvertering av \\nstandardiserte betalingsfiler fra bank, transformasjon av hovedbok, fakturajournal og \\nutest\xe5ende poster for bistand i Cash to Revenue-analyse. \\nPower BI-konsulent: Utvikling i Python og Power BI for analyse av konsernets \\noperasjonelle omsetning benyttet i revisjons\xf8yemed. \\nFERDE AS\\nSektor:Privat sektorRevisjon - Cash to Revenue-analyse, 01.2022 - 02.2023\\nPower BI-konsulent, ca. 50 timer\\nUtviklet Power BI modell benyttet i konsernrevisjon. Modell inneholdt konvertering av \\nstandardiserte betalingsfiler fra bank, transformasjon av hovedbok, fakturajournal og \\nutest\xe5ende poster for bistand i Cash to Revenue-analyse. \\nPower BI-konsulent: Utvikling i Python og Power BI for analyse av konsernets \\noperasjonelle omsetning benyttet i revisjons\xf8yemed. \\nBarnas Hus\\nSektor:Privat sektorManaged services, 06.2023 - 07.2023\\nFinanskonsulent, ca. 40 timer\\nImplementering av EDI-l\xf8sning for innkj\xf8psordrebestilling.\\nFinanskonsulent: Harald har gjennomf\xf8rt implementering, testing og utrulling av \\nl\xf8sning for bestilling av innkj\xf8psordre via EDI, ved bruk av tredjepartsleverand\xf8r To-\\nIncrease. Harald har ogs\xe5 gjennomf\xf8rt oppsett og dokumenth\xe5ndtering i Azure ved \\nl\xf8sning mot SFTP.\\nSpar Kj\xf8p AS\\nSektor:Privat sektorImplementering av Dynamics 365 Finance and Operations, 09.2021 - 09.2023\\nFinanskonsulent, Teknisk konsulent , ca. 1500 timer\\nSpar Kj\xf8p er et familieeid selskap etablert i 1962 som driver detaljhandel. De har i\', metadata={\'source\': \'merged.pdf\', \'page\': 1}), Document(page_content=\'Finanskonsulent, Teknisk konsulent , ca. 1500 timer\\nSpar Kj\xf8p er et familieeid selskap etablert i 1962 som driver detaljhandel. De har i \\n\xa9 2024  KPMG AS, a Norwegian limited liability company and a member firm of the KPMG network of independent member firms affiliated with KPMG International Cooperative (KPMG International), a Swiss entity. All rights reserved.\', metadata={\'source\': \'merged.pdf\', \'page\': 1}), Document(page_content=\'Harald Andreas Osan\\nSenior Associate\\ndag en nettbutikk, samt 24 varehus i Norge, fra Kirkenes i nord til Kristiansand i s\xf8r. \\nHovedkontoret og hovedlageret ligger p\xe5 Kokstad i Bergen. Spar Kj\xf8p har for \\n\xf8yeblikket ca. 600 ansatte, fordelt p\xe5 varehusene, hovedkontoret og hovedlageret. \\nSpar Kj\xf8p bruker for \xf8yeblikket AX 2009 og \xf8nsker \xe5 oppgradere til Dynamics 365 F \\n& SCM. KPMG er ansvarlig for implementeringen av Dynamics 365 med Retail / \\nCommerce -funksjonalitet. Vi bruker rammeverket som fokuserer p\xe5 prosesser for \\nl\xf8sning. Dette kalles Powered Enterprise.\\nFinanskonsulent: For Spar Kj\xf8p har Harald arbeidet hovedsakelig med \\nintegrasjoner og arkitektur knyttet til finansmodulene i Dynamics 365. Dette innebar \\nutarbeidelse av l\xf8sning, dokumentasjon, implementering, testing og leveranse av de \\nforskjellige tilpasninger og integrasjoner. Integrasjoner inneholdt funksjonalitet for \\nbankavstemming, inng\xe5ende og utg\xe5ende ordre h\xe5ndtering, fakturering og betaling. \\nTeknisk konsulent: Gjennom prosjektet jobbet Harald tett opp mot utviklerteam og \\nbisto med arkitektur, enhetstesting og utvikling av forkskjellige integrasjoner, spesifikt \\ninnenfor HR-segment og mot leverand\xf8rreskontro. Harald har ogs\xe5 innehatt rolle som\\nadministrator for Azure DevOps og vedlikeholdt l\xf8sning i henhold til spesifikasjon i \\nprosjektet og utvidet ved behov for ny funksjonalitet. Mot prosjektets slutt og etter Go-\\nLive har Harald bist\xe5tt med overlevering til kunde og v\xe6rt ressurs med inng\xe5ende \\nkjennskap til Azure-l\xf8sning. herunder Service Bus, Logic Apps, Functions og Data \\nLake. Harald har gjennomf\xf8rt implementering, testing og utrulling av l\xf8sning for \\nbestilling av innkj\xf8psordre via EDI, ved bruk av tredjepartsleverand\xf8r To-Increase. \\nHarald har ogs\xe5 gjennomf\xf8rt oppsett og dokumenth\xe5ndtering i Azure ved l\xf8sning mot\\nSFTP. L\xf8sningen tok i bruk flere ordreflyter for utg\xe5ende bestilling, inng\xe5ende \\nordrebekreftelse og pakkseddel i EDI-format. \\n\xa9 2024  KPMG AS, a Norwegian limited liability company and a member firm of the KPMG network of independent member firms affiliated with KPMG International Cooperative (KPMG International), a Swiss entity. All rights reserved.\', metadata={\'source\': \'merged.pdf\', \'page\': 2}), Document(page_content=\'Marie Nerg\xe5rd Killi\\nAssociate \\nKPMG\\n94361447marie.killi@kpmg.no\\nSPISSKOMPETANSE\\nERP-implementering\\nProsjektledelse\\nDynamics365\\nAzure DevOpsERFARING\\nMarie er ansatt i KPMG Advisory og er en del av  tjenesteomr\xe5det Technology \\nConsulting hvor hun blant annet har bist\xe5tt som prosjektst\xf8tte og prosjektressurs i \\nflere prosjekter i grensesnittet mellom IT og forretning. Hun har erfaring fra ERP-\\nimplementeringsprosjekter b\xe5de p\xe5 kunde- og leverand\xf8rsiden. Videre har hun ogs\xe5 \\nerfaring med prosesskartlegging og prosessforbedring i forbindelse med ERP-\\nsystemer. \\nHun er utdannet \xf8konom med fordypning i logistikk og bedriftsstrategi, i tillegg til en \\nst\xf8tteprofil innen \xf8konomi i energisektoren. Fra studiet har Marie tilegnet seg \\nerfaring innen prosjekt- og prosessledelse, strategiske analyser og b\xe6rekraftige \\nforretningsmodeller. Hun er sertifisert i Prince2 (Prosessbasert tiln\xe6rming til \\nprosjektledelse). Hun har en stor interesse for arbeid i skj\xe6ringspunktet mellom \\nteknologi og mennesker og har derfor spesialisert seg p\xe5 implementering av CRM og\\nERP-systemer. \\nMarie har gode analytiske ferdigheter, og er dyktig innen prosessforbedring og \\nanalysearbeid. Marie har ved flere anledninger jobbet med komplekse prosjekter. \\nHer har hun tilegnet seg organisatoriske evner og innsikt i hvordan lede \\nmedarbeidere til \xe5 oppn\xe5 m\xe5l. Hun har en strukturert og effektiv tiln\xe6rming til \\nproblemstillinger, tar ansvar, er en p\xe5driver i prosjekter og er opptatt av \xe5 levere h\xf8y \\nkvalitet i sine leveranser.\\nTIDLIGERE ARBEIDSERFARING\\nKPMG Norway\\nAssociate , 08.2022 - d.d.\\nAnsatt i KPMG Advisory og er en del av tjenesteomr\xe5det Technology Consulting\\nUTDANNING\\nM.S.c Management and International business, LUISS Guido Carli University , \\n2020 - 2022\\nSpesialisering innen internasjonal business. Med valgfag som Management and \\neconomy in Energy Business, Supply Chain Management og Corporate Strategy.\\nMasteroppgave: b\xe6rekraftig utvikling av havvind i Norge \\nB.Sc i Internasjonal Markedsf\xf8ring, Handelsh\xf8yskolen BI Bergen , 2016 - 2020\\nKompetanse innen internasjonale marked, kommunikasjon og forhandlinger\\nSERTIFISERING OG AKKREDITERING\\nBloomberg Market Concepts (2021)\\nPRINCE2 Foundation, 7th edition (2023)\\nPRINCE2 er en prosessbasert tiln\xe6rming til effektiv prosjektledelse. Metoden best\xe5r \\nav syv strukturerte prosesser som er n\xf8dvendig for \xe5 styre, lede og levere prosjekter \\np\xe5 en vellykket og god m\xe5te, og for \xe5 f\xf8lgelig oppn\xe5 prosjektets definerte m\xe5l. \\nMetoden er internasjonal, og kan skreddersys og tilpasses de fleste organisasjoner, \\nbransjer og prosjekter.\\nPUBLIKASJONER OG FOREDRAG\\n  Introduksjon til Microsoft Co-pilot\\nSPR\xc5K\\n  Norsk: Morsm\xe5l\\n\xa9 2024  KPMG AS, a Norwegian limited liability company and a member firm of the KPMG network of independent member firms affiliated with KPMG International Cooperative (KPMG International), a Swiss entity. All rights reserved.\', metadata={\'source\': \'merged.pdf\', \'page\': 3}), Document(page_content=\'Marie Nerg\xe5rd Killi\\nAssociate \\n  Engelsk: Flytende\\n  Italiensk: Grunnleggende\\nPROSJEKTERFARING\\nDOF AS\\nSektor:\\nShippingVision & Validate, 03.2024 - d.d.\\nAlver Kommune\\nSektor:\\nOffentlig sektorForvaltningsrevisjon\\nEdda Wind\\nSektor:\\nOffshore vindSystemanskaffelse , 03.2024 - 06.2024\\nFagressurs\\nAlver Kommune\\nSektor:\\nOffentlig sektorRisiko- og vesentlighetsanalyse, 01.2024 - d.d.\\nFagressurs , ca. 75 timer\\nGjennomf\xf8ring av risiko- og vesentlighetsvurdering i samsvar med krav i lov om \\nkommuner og fylkeskommuner\\nReykjavik Energy\\nSektor:\\nPrivat sektorImplementering av nytt ERP-system\\nKPMG Norge bist\xe5r KPMG Island med anskaffelsen av et nytt ERP-system for \\nReykjavik Energy. Marie er involvert i dokumenth\xe5ndtering, prosesskartlegging og \\nprosjektledelse\\nDC Resources\\nSektor:\\nPrivat sektorImplementering av nytt ERP-system, 09.2023 - d.d.\\nFageressurs / Prosjektledelse\\nProsjektet inneb\xe6rer bistand i anskaffelsesprosessen av en ny ERP-l\xf8sning, \\nutarbeidelse av RFP (Request for Proposal)-dokumenter, samt kvalifisering av \\nleverand\xf8rer og potensielle ERP-plattformer. Marie bidrar som prosjektst\xf8tte, \\ninkludert forberedelse av RFP-dokumenter, deltakelse i workshops for \xe5 kartlegge \\nn\xe5v\xe6rende prosesser, behov og krav for den nye l\xf8sningen, samt kvalifisering av \\npotensielle leverand\xf8rer og ERP-plattformer.\\nSpar Kj\xf8p AS\\nSektor:\\nRetailBistand innkj\xf8psfunksjon, 2023 - d.d.\\nFunksjonell Konsulent SCM\\nFunksjonell Konsulent SCM:  Marie sin rolle i innkj\xf8psavdelingen har v\xe6rt \xe5 aktivt \\nbidra til \xe5 optimalisere innkj\xf8psprosesser ved \xe5 benytte tekniske l\xf8sninger i Microsoft \\nD365. Hun hatt ansvar for \xe5 s\xf8rge for synkronisering og oppdatering av data for \xe5 \\nsikre at innkj\xf8psdata er n\xf8yaktig og oppdaterte, samt \xe5 motta og registrere mottak av\\nvarer og produkter i lagersystemet. I tillegg har hun utf\xf8rt andre daglige driftsgj\xf8rem\xe5l\\nsom inkluderer behandling av innkj\xf8psordre og styring av lagerbeholdning. \\nMarie har ogs\xe5 benyttet Azure Service bus for \xe5 overv\xe5ke systemets funksjonalitet i \\nD365, inkludert overv\xe5king av meldingsflyt for \xe5 sikre at meldinger ble riktig sendt og \\nmottatt. Videre har hun brukt Service Bus til \xe5 feils\xf8ke eventuelle problemer og rette \\nopp feil i systemet, som har bidratt til \xe5 opprettholde en jevn og p\xe5litelig drift.  \\nSpar Kj\xf8p AS\\nSektor:\\nRetailImplementering av nytt ERP / WMS-system, 2023 - d.d.\\nFunksjonell konsulent\\nFunksjonell konsulent:  Marie har bist\xe5tt i prosjektet hvor leveransen er \\nimplementering av nytt ERP-system. Hun har i dette prosjektet bidratt med flere \\narbeidsoppgaver, som blant annet har innbefattet \xe5 konfigurere Microsoft D365 F&O \\nmoduler, oppf\xf8lging av mangler og n\xf8dvendige endringer, samt hatt del-ansvar for \\n\xa9 2024  KPMG AS, a Norwegian limited liability company and a member firm of the KPMG network of independent member firms affiliated with \\nKPMG International Cooperative (KPMG International), a Swiss entity. All rights reserved.\', metadata={\'source\': \'merged.pdf\', \'page\': 4}), Document(page_content=\'Marie Nerg\xe5rd Killi\\nAssociate \\nteknisk implementering av arbeid innen innkj\xf8p. Marie har i tillegg arbeidet med \xe5 \\nsystematisere og dokumentere oppl\xe6ringsdokumenter, samt utarbeide og utbedre \\nslik dokumentasjon. Dette arbeidet krevde et helhetlig overblikk, samt systematisk \\narbeid da det er omfattende elementer og komponenter som inng\xe5r.\\nSpar Kj\xf8p AS\\nSektor:RetailImplementering av nytt ERP / WMS-system, 2022 - d.d.\\nProsjektledelse\\nProsjektledelse: Marie har bist\xe5tt i prosjektledelsen hvor leveransen var \\nimplementering av nytt ERP -og WMS system, inkludert flere ISV-l\xf8sninger. I dette \\nprosjektet har Marie bist\xe5tt med flere ulike arbeidsoppgaver, som blant annet har \\ninnb\xe6rt leveranseoppf\xf8lging, risikoanalysering, prosjektdesign samt \\n\xf8konomirapportering. \\nG2 Ocean AS\\nSektor:ShippingImplementering av nytt Voyage Management System, 2022 - d.d.\\nAssisterende PMO\\nAssisterende PMO: Som assisterende PMO bistod Marie i \xe5 gjennomf\xf8re blant \\nannet risikoanalyser, leveranseoppf\xf8lging og koordinering for gjennomf\xf8ring av golive\\nav nytt ERP-system. Prosjektet krevde gode organisatoriske ferdigheter, da det \\ninnebar  koordinering p\xe5 tvers av tidssoner med mange hundre ansatte. \\n\xa9 2024  KPMG AS, a Norwegian limited liability company and a member firm of the KPMG network of independent member firms affiliated with KPMG International Cooperative (KPMG International), a Swiss entity. All rights reserved.\', metadata={\'source\': \'merged.pdf\', \'page\': 5}), Document(page_content=\'Torgils \xc5kra Eldrup\\nAssociate\\nKPMG\\n93218511torgils.eldrup@kpmg.no\\nSPISSKOMPETANSE\\n\xd8konomi\\nPower BI\\nFinans\\nAnalytisk\\nTeknologi\\nMaskinl\xe6ring / AI \\nDataanalytikerERFARING\\nTorgils tilh\xf8rer tjenesteomr\xe5det Technology Consulting, som er en en del av KPMG \\nAdvisory i Bergen. Han er utdannet sivil\xf8konom med master fra Norges \\nHandelsh\xf8yskole (NHH) med spesialisering i Business Analytics, samt en \\nbachelorgrad fra NTNU Handelsh\xf8yskolen med spesialisering i finansiell styring.\\n  \\nMed en sterk bakgrunn i finans (bachelor) og en avansert forst\xe5else for business \\nanalytics (master), har Torgils utviklet en omfattende forst\xe5else av den \xf8konomiske \\nsiden av virksomheter og en bred kompetanse i hvordan bedrifter kan anvende \\nverkt\xf8y som maskinl\xe6ring, kunstig intelligens, visualisering av datagrunnlag, \\nkvantitative analyser, optimering, simulering og datah\xe5ndtering for \xe5 skape verdi. \\nDette gj\xf8r at han har opparbeidet seg en god dataforst\xe5else og evner seg raskt til \xe5 \\nsette seg inn i nye dataverkt\xf8y. \\nDette har gitt Torgils god tverrfaglig kompetanse i skj\xe6ringspunktet mellom teknologi \\nog \xf8konomi. Med h\xf8y arbeidskapasitet jobber han selvstendig og er strukturert i \\nfremgangsmetoden. Som en im\xf8tekommende og engasjert person er Torgils opptatt \\nav hvordan teamet skal ta i bruk riktig form for kommunikasjon for \xe5 fungere best \\nmulig sammen og oppn\xe5 et felles m\xe5l. Han er vant til \xe5 h\xe5ndtere komplekse \\nproblemer fra ulike perspektiver og trer raskt inn i  nye oppgaver p\xe5 kort varsel for \xe5 \\nm\xf8te selskapets behov. \\nTIDLIGERE ARBEIDSERFARING\\nKPMG AS\\nAssociate , 08.2023 - d.d.\\nTorgils tilh\xf8rer Technology Consulting, som er en del av KPMG Advisory i Bergen.\\nEquinor\\nOperational Purchaser , 06.2022 - 08.2022\\nHovedansvar i Expediting. Analyse av Equinor sin supply chain prosess, fra purchase\\nto pay. Finne forbedringspotensial i systemene og muligheter for \xf8kt effektivisering \\nigjennom digitalisering og programmering. Oppf\xf8lging av saker og feils\xf8king i \\nforsyningskjeden. \\nEquinor\\nSupply Chain Manager , 06.2021 - 08.2021\\nGjennomf\xf8ring av supply chain til Equinor sine installasjoner. V\xe6re bindeleddet \\nmellom Equinor og leverand\xf8rene. Ansvar for bestilling av b\xe5de materiell og tjenester.\\nLyse ut ettersp\xf8rsel, finne leverand\xf8rer og produkt, forhandle pris, logistikk, behandle\\nhastesaker m.m.. \\nUTDANNING\\nUtveksling Master, Universiteit Antwerpen , 2023\\nUtvekslingssemester p\xe5 University of Antwerp, med fag innen portef\xf8ljeforvaltning, \\ninnf\xf8ring i dataengineering, data science og ESG. \\nSivil\xf8konom, Norges Handelsh\xf8yskole (NHH), med profilering i Business \\nAnalytics , 2021 - 2023\\nMaster i \xf8konomi og administrasjon ved Norges Handelsh\xf8yskole med Business \\nAnalytics som hovedprofil, med et utvekslingssemester i Belgia. Studiet gir en god \\nforst\xe5else p\xe5 hvordan man kan ta i bruk kvantitative analyser som verkt\xf8y for \\nverdiskapning i en virksomhet. Studiet tar for seg b\xe5de beslutningsmodeller, \\nprogrammering, databehandling, optimering, simulering, maskinl\xe6ring, forecasting, \\nkunstig intelligens og hvordan man kan bruke statistikkverkt\xf8y til \xe5 identifisere \\nm\xf8nstre i store datasett\\nUtveksling bachelor, Bond University, Australia , 2020\\nUtvekslingssemester p\xe5 Bond University, med fag innen finans, kultur/etikk og \\nmetode. \\n\xa9 2024  KPMG AS, a Norwegian limited liability company and a member firm of the KPMG network of independent member firms affiliated with KPMG International Cooperative (KPMG International), a Swiss entity. All rights reserved.\', metadata={\'source\': \'merged.pdf\', \'page\': 6}), Document(page_content=\'Torgils \xc5kra Eldrup\\nAssociate\\nBachelor i \xf8konomi og administrasjon, med profilering i finans , NTNU \\nHandelsh\xf8yskolen, 2018 - 2021\\nBachelor i \xf8konomi og administrasjon, med fordypning i finans. Studiet gir en \\ngrunnleggende forst\xe5else for hvordan data og tall former samfunnet og bedrifter. \\nKvartermester, Forsvarets befalsutdanning , 2017 - 2018\\nBefalsskolen for sj\xf8forsvaret. Halvt \xe5r med befalsutdanning og et halvt \xe5r i praksis p\xe5 \\nrekruttskolen Madla i Stavanger som instrukt\xf8r. \\nSERTIFISERING OG AKKREDITERING\\nPower BI Data Analyst Associate (PL-300) (2024)\\nPower BI Data Analyst Associate sertifiseringen omhandler dataanalyse og \\nvisualisering ved bruk av Microsoft Power BI-verkt\xf8yet. Sertifiseringen demonstrerer \\nevnen til \xe5 bygge effektive datamodeller, lage informative visualiseringer og utf\xf8re \\navanserte analyser for \xe5 trekke innsikter fra data. Gjennom PL-300 sertifiseringen er \\nman rustet til \xe5 h\xe5ndtere ulike datautfordringer og ta datadrevne beslutninger for \xe5 \\nst\xf8tte organisatoriske m\xe5l\\nPRINCE2 Foundation (2023)\\nPrince2 er en internasjonalt anerkjent prosjektledelsesmetode og sertifisering som \\nbeskriver hvordan man gjennomf\xf8rer prosjekter fra start til slutt. Metoden har \\nopprinnelse i IT-prosjektering og har siden blitt utviklet til \xe5 v\xe6re en generisk metode \\nsom kan benyttes for alle typer prosjekter uavhengig av st\xf8rrelse, bransje, \\norganisasjonsform, geografi og kultur.\\nAzure AI Fundamentals (AI-900) (2023)\\nANNEN RELEVANT INFORMASJON\\n  Analyzing and Visualizing Data with Power BI, edX / Microsoft, 2024\\nDette kurset gir deltakerne en omfattende forst\xe5else av hvordan man analyserer og \\nvisualiserer data ved hjelp av Microsoft Power BI-verkt\xf8yet. Gjennom praktiske \\n\xf8velser og veiledning fra erfarne instrukt\xf8rer l\xe6rer studentene \xe5 importere, \\ntransformere og modellere data for \xe5 skape meningsfulle analyser og visualiseringer. \\nKurset dekker grunnleggende konsepter som dataforberedelse, datamodellering og \\noppretting av interaktive rapporter og dashbord. Etter fullf\xf8ring vil deltakerne v\xe6re \\nrustet til \xe5 bruke Power BI til \xe5 utforske data, oppdage innsikter og kommunisere \\nresultatene effektivt til interessenter\\n  Supervised Machine Learning: Regression and Classification, Coursera , 2024\\nDette kurset gir en grundig innf\xf8ring i maskinl\xe6ring med fokus p\xe5 to viktige omr\xe5der: \\nregresjon og klassifisering. Gjennom forelesninger, praktiske \xf8velser og case-studier \\nl\xe6rer studentene prinsippene og teknikkene som ligger til grunn for \xe5 bygge \\noverv\xe5ket maskinl\xe6ringsmodeller. Kurset dekker grunnleggende konsepter som \\ndataforberedelse, modellvalg, evaluering av modellprestasjon, og tolkning av \\nresultater. Etter fullf\xf8ring vil deltakerne v\xe6re i stand til \xe5 bygge og evaluere effektive \\nregresjons- og klassifiseringsmodeller, og anvende dem p\xe5 virkelige problemstillinger\\nSPR\xc5K\\n  Engelsk: Flytende\\n  Norsk: Arbeidsspr\xe5k\\nPROSJEKTERFARING\\nTryg Insurance\\nSektor:\\nPrivat sektorProsessanalyse/-forbedring og dataanalyse, 11.2023 - 02.2024\\nDataanalytiker og Power BI utvikler\\nTorgils var inne for \xe5 levere to ulike leveranser til Tryg. Prosjektet gikk ut p\xe5 \xe5 bist\xe5 \\nTryg med daglige oppgaver i analyseavdelingen og \xe5 gjennomf\xf8re et prosjekt om \\nvektet automatisering. F\xf8rst og fremst ga han st\xf8tte ved \xe5 utf\xf8re "sp\xf8rringer" (SQL) \\nopp mot "datavarehuset" for \xe5 lage analyser og uthente \xf8nsket informasjon. Den \\nandre delen av leveransen involverte vektet automatisering, hvor det ble unders\xf8kt \\n\xa9 2024  KPMG AS, a Norwegian limited liability company and a member firm of the KPMG network of independent member firms affiliated with \\nKPMG International Cooperative (KPMG International), a Swiss entity. All rights reserved.\', metadata={\'source\': \'merged.pdf\', \'page\': 7}), Document(page_content=\'Torgils \xc5kra Eldrup\\nAssociate\\ntidsbruk p\xe5 manuelle forsikringssaker i forhold til automatiske saker for \xe5 kunne m\xe5le \\nbesparelsen ved automatisering. Det ble gjennomf\xf8rt kvalitetsikring av dataene, \\netterfulgt av utvilkingen av en Power BI rapport som blandt annet synliggjorde ulike \\nKPIer og trender for de ulike seksjonene. Dette muliggjorde en effektiv utvinning av \\n\xf8nsket informasjon for kunden, samtidig som det ga mulighet for grundig analyse av \\ndatasettet. \\nDataanalytiker og Power BI utvikler:  Torgils bisto forretningen med uttrekk av data, \\ndata rensing,  utf\xf8relsen av analyser, opprettelse av en Power BI rapport og \\ngjennomf\xf8re et prosjekt ang\xe5ende vektet automatisering\\nDel en av prosjektet ga kunden muligheten til \xe5 gj\xf8re raskere og mer presise \\nbeslutninger ved uthenting av etterspurte \xf8konomiske KPIer og oversikter.\\nDel to var med p\xe5 \xe5 m\xe5le besparelser/effektivitet av automatisering og dermed \\nidentifisere potensielle omr\xe5der for videre effektivisering via automatisering eller \\nandre effektiviserings tiltak.\\nFirda Seafood Group\\nSektor:Privat sektorImplementering av effektiviseringstiltak, 11.2023 - 01.2024\\nProsjektst\xf8tte / analyse\\nEtter en kartleggingsprosess av \xf8konomi og regnskapsfunksjonen i Firda Seafood \\nGroup var Torgils inne for \xe5 bist\xe5 med implementeringen av forbedrings- og \\neffektiviseringstiltak i \xf8konomifunksjonen som ble definert som "quick wins" for Firda. \\nTiltakene omfatter digitalisering, forenkling av m\xe5nedsavslutning og \\nm\xe5nedsrapportering, effektivisering og forenkling av faktureringsprosessen, samt \\netablering av nye roller.\\nProsjektst\xf8tte / analyse:  Torgils bisto ved workshops, kartlegging av \\nregnskapsprosesser, etableringen av Power-BI rapporter og visualisering av \\nm\xe5nedsrapporter p\xe5 en informativ og effektiv m\xe5te. \\nTolletaten\\nSektor:Offentlig sektorInternrevisjon - Gevinstrealisering, 09.2023 - 11.2023\\nProsjektst\xf8tte \\nProsjektet reviderte Tolletatens rutiner og prosedyrer knyttet til gevinstrealisering \\ninnen IT. Tolletaten hadde igangsatt et st\xf8rre IT-program og \xf8nsket \xe5 sikre at \\norganisasjonen var satt opp slik at en fikk realisert de aktuelle gevinstene b\xe5de via \\nprogrammet og via vanlige linjeaktiviteter. Tolletaten sikrer at de forvalter og f\xf8lger \\nopp gevinstene som er lagt til grunn for de forskjellige prosjektene og programmene \\nsom var igangsatt.\\nNHH (Public institution) Betalingsvilje for n\xf8kkelhullsprodukter, En empirisk analyse av betalingsviljen \\nfor matvarer med N\xf8kkelhullet og hvordan den p\xe5virkes av utvalgte \\ndemografiske variabler, 01.2023 - 06.2023\\nI dette prosjektet var m\xe5let \xe5 unders\xf8ke betalingsviljen p\xe5 matvarer merket med \\nN\xf8kkelhullet og hvordan betalingsviljen ble p\xe5virket av utvalgte demografiske \\nvariabler. Prosjektet var en del av et sammarbeid mellom Norgesgruppen og FOOD \\nprosjektet p\xe5 NHH. Fokuset for prosjektet var \xe5 analysere om det eksisterte en \\nmerbetalingsvilje for matvarer med n\xf8kkelhull merket kontra tilsvarende matvarer \\nuten merket. For \xe5 unders\xf8ke betalingsviljen ble det innhentet flere hundre tusen \\nobservasjoner fra ulike butikker rundt om i Norge. Et sentralt element var s\xe5 \xe5 rense \\nog behandle dataen, visualisere informasjon, strukturere, modifisere og klargj\xf8re \\ndataen for analyse. Det ble s\xe5 tatt i brukt en blanding av metoder og \\nmaskinl\xe6ringsmodeller for \xe5 regne ut estimert betalingsvilje. \\n\xa9 2024  KPMG AS, a Norwegian limited liability company and a member firm of the KPMG network of independent member firms affiliated with KPMG International Cooperative (KPMG International), a Swiss entity. All rights reserved.\', metadata={\'source\': \'merged.pdf\', \'page\': 8}), Document(page_content=\'Maria Anna Krakus\\nAssociate\\nKPMG\\n45780130maria.krakus@kpmg.no\\nSPISSKOMPETANSE\\nIntegrasjoner\\nAkseptansetesting\\nProsjektledelse\\nKommunikasjon\\nUnit4ERFARING\\nMaria startet sin karriere i KPMG i 2022 og er ansatt i avdelingen Technology \\nConsulting. Hun er utdannet sivil\xf8konom ved H\xf8gskulen p\xe5 Vestlandet og \\nHandelsh\xf8yskolen BI, med spesialisering innen logistikk og endringsledelse. Hun tok\\ni tillegg et \xe5rsstudium i psykologi, med fordypning i personalpsykologi. Det unike \\nutdanningsl\xf8pet har gitt hun gode organisatoriske evner og innsikt i hvordan man \\nkan lede medarbeidere til \xe5 oppn\xe5 \xf8nsket resultat. \\nMaria har nylig v\xe6rt prosjektleder for arbeidet med utviklingen og implementeringen \\nav ny \xf8konomiintegrasjon mellom Unit4/UBW i Bergen kommune og et ekstern \\nfagsystem. Hun koordinerte arbeidet med behovskartlegging, hadde hovedansvaret \\nfor planlegging og gjennomf\xf8ring av akseptansetesten fra kunden sin side, og fulgte \\nopp prosjektet frem til Go-Live og overlevering til drift. Gjennom prosjektet ble hun \\ngodt kjent med Unit4 og systemets kompleksitet, og hun evnet \xe5 ha et overordnet \\nblikk over alle prosessene.\\nMaria ble nylig sertifisert i LEAN Green belt, og er fra f\xf8r av sertifisert prosjekt- og \\nendringsleder. Hun anvender den till\xe6rte kunnskapen og ferdighetene i \\narbeidshverdagen og s\xf8ker aktivt \xe5 fordype seg i faget. Hun har tidligere fungert som\\nprosjektleder i prosjektkoordinator i flere digitaliseringsprosjekter. Hennes oppgaver \\nhar blant annet best\xe5tt i \xe5 ivareta dokumentasjonskrav, kommunisere med ulike \\ninteressenter og f\xf8lge opp aktiviteter hos ulike prosjektressurser. Under prosjektets \\ngjennomf\xf8ringsfase har hun ogs\xe5 hatt rollen som testleder av nye IT-systemer og \\nverifisert systemfunksjonalitet opp mot kontrakt/kravspesifikasjon.\\nSiden Maria begynte i KPMG har hun arbeidet mye med prosesskartlegging og \\n-forbedring i flere digitaliseringsprosjekter i den offentlige sektoren. Hun har blant \\nannet v\xe6rt ansvarlig for kartlegging av n\xe5v\xe6rende arbeidsprosesser med tilh\xf8rende \\ndataflyt i flere avdelinger i Bymilj\xf8etaten, for \xe5 deretter sette verdistr\xf8mmen opp mot \\nfunksjonalitet i nytt system. Maria har ogs\xe5 fasilitert flere workshops med komplekse \\nproblemstillinger, der hun har vist evne til \xe5 lede deltakere mot konkrete m\xe5l.\\nMaria har sterke kommunikasjonsferdigheter og gode planleggingsegenskaper, og \\ntar ansvar for \xe5 drive framgang i prosjekter. Hun ser etter forbedringer, tar initiativ, og \\ninkluderer andre. Som person er hun utadvendt, empatisk, og tilpasningsdyktig.\\nTIDLIGERE ARBEIDSERFARING\\nMedia City Bergen/NCE Media\\nInnholds- og eventkoordinator , 08.2021 - 06.2022\\nMaria hadde ansvaret for oppdatering av nettsiden og sosiale media til \\norganisasjonen. I tillegg bistod hun med hjelp til planlegging og gjennomf\xf8ring av \\nprosjekter og arrangementer.\\nUTDANNING\\nMaster i ledelse og endring, Handelsh\xf8yskolen BI Bergen , 2020 - 2022\\nSpesialisering: Ledelse og endring\\nMasteroppgave: Crisis Management in Cross-Cultural Teams, 2022\\nBachelor i \xf8konomi og administrasjon, H\xf8gskolen p\xe5 Vestlandet (HVL) , 2017 - \\n2020\\nSpesialisering: Logistikk\\nBacheloroppgave: "Respekt for mennesket" uten Lean?, 2020\\n\xa9 2024  KPMG AS, a Norwegian limited liability company and a member firm of the KPMG network of independent member firms affiliated with KPMG International Cooperative (KPMG International), a Swiss entity. All rights reserved.\', metadata={\'source\': \'merged.pdf\', \'page\': 9}), Document(page_content=\'Maria Anna Krakus\\nAssociate\\n\xc5rsstudium i psykologi, Universitetet i Bergen (UiB) , 2016 - 2017\\nGrunnleggende emner innen psykologi med fordypning i personalpsykologi.\\nSERTIFISERING OG AKKREDITERING\\nLEAN Green belt (2024)\\nProsci Certified Change Management Practitioner (2022)\\nPRINCE2 Foundation (2022)\\nProsjektledelse\\nSPR\xc5K\\n  Norsk: Flytende\\n  Engelsk: Flytende\\n  Polsk: Flytende\\nPROSJEKTERFARING\\nBergen kommune\\nSektor:\\nOffentlig sektorBergens Digitale Barnevern, 02.2023 - 03.2024\\nProsjektst\xf8tte og koordinator , ca. 300 timer\\nDigitalisering, endringsledelse, omorganisering og organisasjonsutvikling \\nInnf\xf8ring av nytt system for barnevernet som vil endre organisering og arbeidsform \\nfor tjenesten. Prosjektet skal forbedre den kommunale barnevernstjenesten. \\nProsjektet har som form\xe5l \xe5 \xf8ke kvaliteten p\xe5 tjenesteut\xf8velsen og opplevd \\ntjenestemottak for alle brukergrupper, ved hjelp av nye, digitale l\xf8sninger.\\nProsjektet styrer ogs\xe5 teknisk implementering som inkluderer migrering av data, \\nutvikling av eksportklient og integrasjoner mot \xd8k/HR, Arkiv og nasjonal FIKS \\nplatform.\\nEffektm\xe5l:\\n God kvalitet i saksbehandling og oppf\xf8lging\\n Rask behandling og rettferdige beslutninger\\n Likeverdige tjenester og forutsigbarhet for barn og familier\\n Sikkerhet, sporbarhet og kontrollbarhet i all saksbehandling\\n Effektiv og god utnyttelse av samfunnets ressurser \\n Forn\xf8yde ansatte i barnevernet\\nProsjektst\xf8tte og koordinator:  Maria har blant annet ansvar for arbeidet med \\n\xf8konomiintegrasjonen mellom fagsystemet og \xf8konomisystemet i kommunen. Hun \\nkoordinerer samarbeidet mellom leverand\xf8r og intern prosjektgruppe, samt innad i \\nprosjektgruppen med deltakere fra ulike etater og avdelinger. Maria er ansvarlig for \\nforberedelser, planlegging og gjennomf\xf8ring av akseptansetesten av integrasjonen. \\nSammen med prosjektleder fra leverand\xf8r koordinerer hun arbeidet i \\nimplementeringsfasen, inkludert teknisk oppf\xf8lging og oppl\xe6ring av ansatte.\\nBergen kommune\\nSektor:\\nKommunal sektorInnf\xf8ring av fagsystemet ISY Road, 10.2022 - 06.2024\\nProsjektst\xf8tte og delprosjektleder , ca. 1200 timer\\nBymilj\xf8etaten skulle erstatte flere eldre fagsystemer med ett nytt felles s\xf8ke- og \\nsaksbehandlingssystem, ISY Road. Gjennom innf\xf8ringen m\xe5tte samtlige \\narbeidsprosesser kartlegges og tilpasses det nye systemet. Systemet m\xe5tte ogs\xe5 \\nvidereutvikles for \xe5 st\xf8tte n\xf8dvendig funksjonalitet, og videre integreres mot andre \\nfag- og kjernesystemer. Prosjektet har involvert de fleste avdelinger i etaten og krevd \\nomfattende endringsarbeid.\\nProsjektst\xf8tte og delprosjektleder:  Maria har blant annet ansvar for omfattande \\nintern og ekstern oppl\xe6ring og brukerveiledning, der hun har utarbeidet eget \\noppl\xe6ringsmateriell og brukt det b\xe5de til presentasjoner og dokumentasjon av interne\\nprosesser. Gjennom prosjektet har Maria gjennomf\xf8rt flere workshops med fokus p\xe5 \\nh\xe5ndtering av organisatoriske utfordringer med hjelp av teknologiske l\xf8sninger. Maria\\n\xa9 2024  KPMG AS, a Norwegian limited liability company and a member firm of the KPMG network of independent member firms affiliated with \\nKPMG International Cooperative (KPMG International), a Swiss entity. All rights reserved.\', metadata={\'source\': \'merged.pdf\', \'page\': 10}), Document(page_content=\'Maria Anna Krakus\\nAssociate\\ner i tillegg ansvarlig for kommunikasjon internt og mot innbyggere, kontakt med \\nsupport hos leverand\xf8ren, og testing av l\xf8sningen. Hun har ogs\xe5 bist\xe5tt prosjektleder\\nmed testing, idriftsetting og oppf\xf8lging av integrasjonen mot b\xe5de \xf8konomisystemet \\nog arkivl\xf8sningen i kommunen.\\nBergen kommune\\nSektor:Kommunal sektorRevidering av regelverk og prisliste for leie av offentlig areal, 10.2022 - 02.2023\\nProsjektleder, ca. 160 timer\\nBymilj\xf8etaten hadde behov for konsulentbistand til revidering av "Regelverk for bruk \\nav kommunale parker, friomr\xe5der, byfjell og byrom til arrangementer m.m." og prisliste\\nfor arrangement. Regelverket danner beslutningsgrunnlaget for innvilgelser av \\ns\xf8knader om leie av byrom for arrangement. M\xe5let var et fagnotat om foresl\xe5tte \\nendringer som skulle vedtas av bystyret og byr\xe5det.\\nProsjektleder: I rollen sin som prosjektleder ledet Maria en intern arbeidsgruppe \\nbest\xe5ende av saksbehandlere, jurister og avdelingsledere. Hun hadde ansvar for \xe5 \\nfasilitere og innkalle til m\xf8ter, skrive m\xf8tereferater og holde fremdrift i prosjektet. Hun\\nplanla og gjennomf\xf8rte flere workshops og m\xf8ter med eksterne interessenter. \\nSluttproduktet bestod av et utkast til fagnotat, revidert regelverk og revidert prisliste.\\n\xa9 2024  KPMG AS, a Norwegian limited liability company and a member firm of the KPMG network of independent member firms affiliated with KPMG International Cooperative (KPMG International), a Swiss entity. All rights reserved.\', metadata={\'source\': \'merged.pdf\', \'page\': 11})]
vector = FAISS.from_documents(documents, embeddings)

#Set retriever and create retrieval chain
retriever = vector.as_retriever()
prompt = ChatPromptTemplate.from_messages([
    MessagesPlaceholder(variable_name="chat_history"),
    ("user", "{input}"),
    ("user", "Given the above conversation, generate a search query to look up to get information relevant to the conversation")
])
retriever_chain = create_history_aware_retriever(chat, retriever, prompt)

prompt = ChatPromptTemplate.from_messages([
    ("system", "Answer the user's questions based on the below context:\n\n{context}"),
    MessagesPlaceholder(variable_name="chat_history"),
    ("user", "{input}"),
])

document_chain = create_stuff_documents_chain(chat, prompt)
retrieval_chain = create_retrieval_chain(retriever_chain, document_chain)

def build_message_list():
    """
    Build a list of messages including system, human and AI messages.
    """
    # Start zipped_messages with the SystemMessage
    zipped_messages = [SystemMessage(
        content="You are a helpful AI assistant talking with a human. If you do not know an answer, just say 'I don't know', do not make up an answer.")]

    # Zip together the past and generated messages
    for human_msg, ai_msg in zip_longest(st.session_state['past'], st.session_state['generated']):
        if human_msg is not None:
            zipped_messages.append(HumanMessage(
                content=human_msg))  # Add user messages
        if ai_msg is not None:
            zipped_messages.append(
                AIMessage(content=ai_msg))  # Add AI messages

    return zipped_messages


def generate_response(user_input):
    """
    Generate AI response using the ChatOpenAI model.
    """
    # Build the list of messages
    zipped_messages = build_message_list()
    output = retrieval_chain.invoke({"chat_history":zipped_messages,"input":user_input})
    # Generate response using the chat model
    return output['answer']


# Define function to submit user input
def submit():
    # Set entered_prompt to the current value of prompt_input
    st.session_state.entered_prompt = st.session_state.prompt_input
    # Clear prompt_input
    st.session_state.prompt_input = ""


# Create a text input for user
st.text_input('YOU: ', key='prompt_input', on_change=submit)


if st.session_state.entered_prompt != "":
    # Get user query
    user_query = st.session_state.entered_prompt

    # Generate response
    output = generate_response(user_query)

    # Append user query to past queries
    st.session_state.past.append(user_query)

    # Append AI response to generated responses
    st.session_state.generated.append(output)

# Display the chat history
if st.session_state['generated']:
    for i in range(len(st.session_state['generated'])-1, -1, -1):
        # Display AI response
        message(st.session_state["generated"][i], key=str(i))
        # Display user message
        message(st.session_state['past'][i],
                is_user=True, key=str(i) + '_user')


# Add credit
st.markdown("""
---
Laget med 🤖 av Harald Osan""")
